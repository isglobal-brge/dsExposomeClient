<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Non-disclosive federated exposome data analysis with DataSHIELD and Bioconductor • dsExposomeClient</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Non-disclosive federated exposome data analysis with DataSHIELD and Bioconductor">
<meta property="og:description" content="dsExposomeClient">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsExposomeClient</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dsExposome.html">Non-disclosive federated exposome data analysis with DataSHIELD and Bioconductor</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Non-disclosive federated exposome data analysis with DataSHIELD and Bioconductor</h1>
                        <h4 data-toc-skip class="author">Xavier Escribà Montagut</h4>
            <address class="author_afil">
      Bioinformatics Research Group in Epidemiolgy (BRGE), Barcelona Insitute for Global Health (ISGlobal)<br><a class="author_email" href="mailto:#"></a><a href="mailto:xavier.escriba@isglobal.org" class="email">xavier.escriba@isglobal.org</a>
      </address>
                              <h4 data-toc-skip class="author">Juan R. Gonzalez</h4>
            <address class="author_afil">
      Bioinformatics Research Group in Epidemiolgy (BRGE), Barcelona Insitute for Global Health (ISGlobal)<br><a class="author_email" href="mailto:#"></a><a href="mailto:juanr.gonzalez@isglobal.org" class="email">juanr.gonzalez@isglobal.org</a>
      </address>
                  
            <h4 data-toc-skip class="date">2022-03-04</h4>
      
      
      <div class="hidden name"><code>dsExposome.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Sharing data across studies that are subject to confidentiality and must comply with data protection regulations is a challenging task. <a href="http://www.datashield.ac.uk/" class="external-link">DataSHIELD</a> is a software solution for secure biomedicine collaboration that allows privacy-protected data analysis of federated databases. It enables the remote and non-disclosive analysis of sensitive research data, and has been developed under several EC projects (BioSHaRE-EU, InterConnect, LifeCycle, EUCAN-Connect). So far, DataSHIELD includes an extensive set of disclosure-protected functions for data manipulation, exploratory data analytics, generalised linear modelling and data visualizations. Here, we have extend DataSHIELD tools by incorporating new functionalities to deal with exposome data visualization and association analysis. We also illustrate how to integrate omics information with exposome data.</p>
<p><a href="http://opaldoc.obiba.org/en/latest/" class="external-link">Opal</a> is <a href="https://www.obiba.org/" class="external-link">OBiBa</a>’s core database application for epidemiological studies. Participant data, collected by questionnaires, medical instruments, sensors, administrative databases etc. can be integrated and stored in a central data repository under a uniform model. Opal is a web application that can import, process, copy data and has advanced features for cataloging the data (fully described, annotatted and searchable data dictionaries). Opal is typically used in a research center to analyze the data acquired at assessment centres. Its ultimate purpose is to achieve seamless data-sharing among epidemiological studies. Opal is the reference implementation of the DataSHIELD infrastructure.</p>
<p>Developing and implementing new algorithms to perform advanced data analyses under DataSHIELD framework is a current active line of research. However, the analysis of big data within DataSHIELD has some limitations. Some of them are related to how data is managed in the Opal’s database and others are related to how to perform statistical analyses of big data within the R environment. Opal databases are for general purpose and do not properly manage large amounts of information and, second, it requires moving data from original repositories into Opal which is inefficient (this is a time, CPU and memory consuming operation) and is difficult to maintain when data are updated. We have recently overcome the problem related to DataSHIELD big data management by developing a new data infrastructure within Opal: <a href="https://isglobal-brge.github.io/resource_bookdown/resources.html" class="external-link">the resources</a>. In this <a href="https://isglobal-brge.github.io" class="external-link">bookdown</a> the reader can learn a bit more about Opal, DataSHIELD and other releated issues.</p>
<p>This new infrastructure allow us, among others, the analysis of exposome data since we can define a resource as an <code>ExposomeSet</code> an specific method to <a href="https://www.bioconductor.org/packages/release/bioc/vignettes/rexposome/inst/doc/exposome_data_analysis.html" class="external-link">encapsulate exposome data</a>) in R.</p>
<p>For those who are not familiar with Opal servers and do not know how to create this infrastructure, we recommend to read <a href="https://isglobal-brge.github.io/resource_bookdown/tips-and-tricks.html" class="external-link">this section</a> from our bookdown.</p>
<div class="section level3">
<h3 id="exposome-data-in-a-demo-opal-server">Exposome data in a demo Opal server<a class="anchor" aria-label="anchor" href="#exposome-data-in-a-demo-opal-server"></a>
</h3>
<p>We have created an <a href="https://opal-demo.obiba.org/" class="external-link">Opal demo server</a> that contains different projects, including one called EXPOSOME, as we can see in the next figure</p>
<div class="figure">
<img src="figures/opal_projects.png" alt=""><p class="caption">Opal projects in our Opal demo server</p>
</div>
<p>The Opal server can be accessed with the credentials:</p>
<ul>
<li>username: <code>administrator</code>
</li>
<li>password: <code>password</code>
</li>
</ul>
<p>The EXPOSOME project contains 4 resources. One <code>ExposomeSet</code> object and three other .csv files containing required data for exposome studies: exposome data, exposome annotation and phenotype information.</p>
<div class="figure">
<img src="figures/resources_exposome.png" alt=""><p class="caption">Resources available in the EXPOSOME Opal project</p>
</div>
<p>Therefore, we will assume that the user will have either an <code>ExposomeSet</code> object or different text/Excel files having exposome data. The <code>ds.Exposome</code> package should also be installed into the Opal server (see <a href="https://isglobal-brge.github.io/resource_bookdown/tips-and-tricks.html#how-to-install-datashield-packages-into-opal-server" class="external-link">here</a> to know how to do it).</p>
<p>Next, we illustrate how to perform the main analyses using <code>ds.ExposomeClient</code> packages that should be installed in the R client side by using</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"isglobal-brge/dsExposomeClient"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-the-required-exposomeset-object">Creating the required <code>ExposomeSet</code> object<a class="anchor" aria-label="anchor" href="#creating-the-required-exposomeset-object"></a>
</h3>
<p>An <code>ExposomeSet</code> object is made up from <a href="https://www.bioconductor.org/packages/release/bioc/vignettes/rexposome/inst/doc/exposome_data_analysis.html#data-format" class="external-link">three different tables</a>. Having an <code>ExposomeSet</code> extremely facilitates exposome data analysis within <code>dsExposomeClient</code>. Two minimum pieces of information (e.g. objects) are required:</p>
<ul>
<li>exposures: data frame/tibble having the individual ID and the exposure variables;</li>
<li>phenotypes: data frame/tibble having the individual ID, outcomes and the covariates.</li>
</ul>
<p>It is also possible to incorporate annotated information on exposures in a separate object (although it is not mandatory):</p>
<ul>
<li>description: data frame/tibble having the exposure names and metadata such as families of exposure</li>
</ul>
<p>The objects need to be coerced into a R object of class <code>ExposomeSet</code> that can be done using <code><a href="../reference/ds.loadExposome.html">ds.loadExposome()</a></code> function as follows.</p>
<p>We first start by loading the required packages</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dsBaseClient</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dsExposomeClient</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSOpal/" class="external-link">DSOpal</a></span><span class="op">)</span></code></pre></div>
<p>Then, we load both exposome and phenotype data into the study servers. On this example, the tables are on the demo Opal server as resources (see @ref(fig:resourcesExpo)), which means they have to be loaded on the study server and be coerced as data frames as described <a href="https://isglobal-brge.github.io/resource_bookdown/resourcer.html#using-resources-with-datashield" class="external-link">here</a>.</p>
<p>Of course, the user may also have exposome and phenotypes information in Opal tables that can also be loaded into the servers using <a href="https://isglobal-brge.github.io/resource_bookdown/datashield.html#demo" class="external-link">standard DataSHIELD functions</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server1"</span>, url <span class="op">=</span> <span class="st">"https://opal-demo.obiba.org/"</span>,
               user <span class="op">=</span> <span class="st">"dsuser"</span>, password <span class="op">=</span> <span class="st">"P@ssw0rd"</span>,
               driver <span class="op">=</span> <span class="st">"OpalDriver"</span>, profile <span class="op">=</span> <span class="st">"exposome"</span><span class="op">)</span>
<span class="va">logindata</span> <span class="op">&lt;-</span> <span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span>
<span class="va">conns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span>logins <span class="op">=</span> <span class="va">logindata</span><span class="op">)</span>

<span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.assign.resource.html" class="external-link">datashield.assign.resource</a></span><span class="op">(</span><span class="va">conns</span>, symbol <span class="op">=</span> <span class="st">'exposures'</span>, resource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>server1 <span class="op">=</span> <span class="st">'EXPOSOME.exposures'</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.assign.expr.html" class="external-link">datashield.assign.expr</a></span><span class="op">(</span><span class="va">conns</span>, symbol <span class="op">=</span> <span class="st">"exposures"</span>, expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu">as.resource.data.frame</span><span class="op">(</span><span class="va">exposures</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.assign.resource.html" class="external-link">datashield.assign.resource</a></span><span class="op">(</span><span class="va">conns</span>, symbol <span class="op">=</span> <span class="st">'phenotypes'</span>, resource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>server1 <span class="op">=</span> <span class="st">'EXPOSOME.phenotypes'</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.assign.expr.html" class="external-link">datashield.assign.expr</a></span><span class="op">(</span><span class="va">conns</span>, symbol <span class="op">=</span> <span class="st">"phenotypes"</span>, expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu">as.resource.data.frame</span><span class="op">(</span><span class="va">phenotypes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.ls.html" class="external-link">ds.ls</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
$server1$environment.searched
[1] "R_GlobalEnv"

$server1$objects.found
[1] "exposures"  "phenotypes"</code></pre>
<p>As it can be seen, there are two objects in the opal server (<code>exposures</code> and <code>phenotypes</code>) that are the required ones for <code>dsExposomeClient</code> package. Note that both have a common variable ( <code>idnum</code> in our case) that will be used to link the two objects when creating the <code>ExposomeSet</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"exposures"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
 [1] "idnum"        "PFHxS"        "PFOA"         "PFOS"         "PFNA"        
 [6] "DDE"          "DDT"          "HCB"          "bHCH"         "PCB118"      
[11] "PCB153"       "PCB180"       "PCB138"       "BDE17"        "BDE28"       
[16] "BDE71"        "BDE47"        "BDE66"        "BDE100"       "BDE99"       
[21] "BDE85"        "BDE154"       "BDE153"       "BDE138"       "BDE183"      
[26] "BDE190"       "BDE209"       "Hg"           "Co"           "Ni"          
[31] "As"           "Cu"           "Zn"           "Se"           "Mo"          
[36] "Cd"           "Sb"           "Cs"           "Tl"           "Pb"          
[41] "MEHP"         "MEHHP"        "X5cxMEPP"     "X2cxMMHP"     "MEP"         
[46] "MiBP"         "MnBP"         "X7OHMMeOP"    "MBzP"         "MEOHP"       
[51] "BPA"          "THM"          "CHCl3"        "BTHM"         "Cotinine"    
[56] "Gas"          "ETS"          "H_pesticides" "G_pesticides" "Benzene"     
[61] "PM25CU"       "PM25FE"       "PM25K"        "PM25Ni"       "PM25S"       
[66] "PM25Sl"       "PM25V"        "PM25Zn"       "PM10Cu"       "PM10Fe"      
[71] "PM10K"        "PM10Ni"       "PM10S"        "PM10SI"       "PM10V"       
[76] "PM10Zn"       "NO2"          "NO"           "NOx"          "PM25"        
[81] "PM10"         "PMcoarse"     "AbsPM25"      "Dens"         "Conn"        
[86] "Green"        "Noise_d"      "Noise_n"      "Temp"        </code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"phenotypes"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
 [1] "idnum"           "whistling_chest" "flu"             "rhinitis"       
 [5] "wheezing"        "birthdate"       "sex"             "age"            
 [9] "cbmi"            "blood_pre"      </code></pre>
<p>Now, we are ready to create the <code>ExposomeSet</code> object. To this end, the <code><a href="../reference/ds.loadExposome.html">ds.loadExposome ()</a></code> function should be used. It takes as input parameters the names of the objects on the study server among some further configuration options. Please, refer to the function documentation for more information.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.loadExposome.html">ds.loadExposome</a></span><span class="op">(</span>exposures <span class="op">=</span> <span class="st">"exposures"</span>, 
                phenotypes <span class="op">=</span> <span class="st">"phenotypes"</span>, 
                exposures.idcol <span class="op">=</span> <span class="st">"idnum"</span>, 
                phenotypes.idcol <span class="op">=</span> <span class="st">"idnum"</span>, 
                object_name <span class="op">=</span> <span class="st">"exposome_object"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.class.html" class="external-link">ds.class</a></span><span class="op">(</span><span class="st">"exposome_object"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "ExposomeSet"
attr(,"package")
[1] "rexposome"</code></pre>
<p>The function also allows to incorporate metadata on the exposures that can be used to improve results visualization. This requires to have another object (in our case called <code>description</code>) that can be loaded into the Opal server as</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.assign.resource.html" class="external-link">datashield.assign.resource</a></span><span class="op">(</span><span class="va">conns</span>, symbol <span class="op">=</span> <span class="st">'description'</span>, resource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>server1 <span class="op">=</span> <span class="st">'EXPOSOME.description'</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.class.html" class="external-link">ds.class</a></span><span class="op">(</span><span class="st">'description'</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "TidyFileResourceClient" "FileResourceClient"     "ResourceClient"        
[4] "R6"                    </code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.assign.expr.html" class="external-link">datashield.assign.expr</a></span><span class="op">(</span><span class="va">conns</span>, symbol <span class="op">=</span> <span class="st">"description"</span>, expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu">as.resource.data.frame</span><span class="op">(</span><span class="va">description</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.class.html" class="external-link">ds.class</a></span><span class="op">(</span><span class="st">'description'</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" </code></pre>
<p>In our case this is the metadata we have</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"description"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "Family"   "Exposure" "Name"    </code></pre>
<p>Then, the <code>ExposomeSet</code> is created by adding further information to <code>dsloadExposome ()</code> function</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.loadExposome.html">ds.loadExposome</a></span><span class="op">(</span>exposures <span class="op">=</span> <span class="st">"exposures"</span>,
                phenotypes <span class="op">=</span> <span class="st">"phenotypes"</span>, 
                exposures.idcol <span class="op">=</span> <span class="st">"idnum"</span>, 
                phenotypes.idcol <span class="op">=</span> <span class="st">"idnum"</span>,
                description <span class="op">=</span> <span class="st">"description"</span>,
                description.expCol <span class="op">=</span> <span class="st">"Exposure"</span>,
                description.famCol <span class="op">=</span> <span class="st">"Family"</span>,
                object_name <span class="op">=</span> <span class="st">"exposome_object"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.class.html" class="external-link">ds.class</a></span><span class="op">(</span><span class="st">"exposome_object"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "ExposomeSet"
attr(,"package")
[1] "rexposome"</code></pre>
<p><strong>NOTE:</strong> In this vignette we are using this object that contains information on family exposures. All the following functions will also work if <code>description</code> is not provided since when <code>description = NULL</code> the <code>ExposomeSet</code> object will have the family name as the exposure one:</p>
<pre><code>Exposure    Family
PFOA        PFOA
pm2.5       pm2.5
pm10        pm10
smoke       smoke
...               ....</code></pre>
<div class="section level4">
<h4 id="loading-the-required-exposomeset-object-from-a-resource-">Loading the required <code>ExposomeSet</code> object from a <em>resource</em>.<a class="anchor" aria-label="anchor" href="#loading-the-required-exposomeset-object-from-a-resource-"></a>
</h4>
<p>The user can also prepare an <code>ExposomeSet</code> outside DataSHILED and provide this information in the Opal server as a <em>resource</em>. Our Opal demo (EXPOSOME project) has an <code>ExposomeSet</code> resource (see Figure @ref(fig:resourcesExpo)) that can be loaded into the study server as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.assign.resource.html" class="external-link">datashield.assign.resource</a></span><span class="op">(</span><span class="va">conns</span>, symbol <span class="op">=</span> <span class="st">'exposome_resource'</span>, resource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>server1 <span class="op">=</span> <span class="st">'EXPOSOME.exposomeSet'</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.ls.html" class="external-link">ds.ls</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
$server1$environment.searched
[1] "R_GlobalEnv"

$server1$objects.found
[1] "description"       "exposome_object"   "exposome_resource"
[4] "exposures"         "phenotypes"       </code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.class.html" class="external-link">ds.class</a></span><span class="op">(</span><span class="st">"exposome_resource"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "RDataFileResourceClient" "FileResourceClient"     
[3] "ResourceClient"          "R6"                     </code></pre>
<p>Once on the study server, the resource has to be coerced into an R object</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.assign.expr.html" class="external-link">datashield.assign.expr</a></span><span class="op">(</span><span class="va">conns</span>, symbol <span class="op">=</span> <span class="st">"exposome_resource"</span>, expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu">as.resource.object</span><span class="op">(</span><span class="va">exposome_resource</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.class.html" class="external-link">ds.class</a></span><span class="op">(</span><span class="st">"exposome_resource"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "ExposomeSet"
attr(,"package")
[1] "rexposome"</code></pre>
<p>In that case, both <code>exposome_object</code> and <code>exposome_resource</code> are containing the same information.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_variables.html">ds.exposome_variables</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="st">"phenotypes"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "whistling_chest" "flu"             "rhinitis"        "wheezing"       
[5] "birthdate"       "sex"             "age"             "cbmi"           
[9] "blood_pre"      </code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_variables.html">ds.exposome_variables</a></span><span class="op">(</span><span class="st">"exposome_resource"</span>, <span class="st">"phenotypes"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "whistling_chest" "flu"             "rhinitis"        "wheezing"       
[5] "birthdate"       "sex"             "age"             "cbmi"           
[9] "blood_pre"      </code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_summary.html">ds.exposome_summary</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="st">"AbsPM25"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
$server1$class
[1] "numeric"

$server1$length
[1] 109

$server1$`quantiles &amp; mean`
       5%       10%       25%       50%       75%       90%       95%      Mean 
0.2163124 0.2508699 0.3192557 0.3542890 0.3967783 0.4380127 0.4778897 0.3546863 </code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_summary.html">ds.exposome_summary</a></span><span class="op">(</span><span class="st">"exposome_resource"</span>, <span class="st">"AbsPM25"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
$server1$class
[1] "numeric"

$server1$length
[1] 109

$server1$`quantiles &amp; mean`
       5%       10%       25%       50%       75%       90%       95%      Mean 
0.2163124 0.2508699 0.3192557 0.3542890 0.3967783 0.4380127 0.4778897 0.3546863 </code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_summary.html">ds.exposome_summary</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="st">"blood_pre"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
$server1$class
[1] "numeric"

$server1$length
[1] 109

$server1$`quantiles &amp; mean`
      5%      10%      25%      50%      75%      90%      95%     Mean 
113.0000 114.0000 117.0000 120.0000 121.0000 124.0000 125.0000 119.0935 </code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_summary.html">ds.exposome_summary</a></span><span class="op">(</span><span class="st">"exposome_resource"</span>, <span class="st">"blood_pre"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
$server1$class
[1] "integer"

$server1$length
[1] 109

$server1$`quantiles &amp; mean`
      5%      10%      25%      50%      75%      90%      95%     Mean 
113.0000 114.0000 117.0000 120.0000 121.0000 124.0000 125.0000 119.0935 </code></pre>
</div>
</div>
<div class="section level3">
<h3 id="exploring-the-exposomeset">Exploring the <code>ExposomeSet</code><a class="anchor" aria-label="anchor" href="#exploring-the-exposomeset"></a>
</h3>
<p>Once the <code>ExposomeSet</code> is created in the study servers, some simple functions can be used to have some understanding of what the dataset contains. Those correspond to the name of the exposures, the names of the families of the exposures and the name of the phenotypes.</p>
<div class="section level4">
<h4 id="family-names">Family names<a class="anchor" aria-label="anchor" href="#family-names"></a>
</h4>
<p>To get the names of the families of exposures available on the <code>ExposomeSet</code> we can use the function <code><a href="../reference/ds.familyNames.html">ds.familyNames()</a></code> function.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.familyNames.html">ds.familyNames</a></span><span class="op">(</span><span class="st">"exposome_object"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
 [1] "Air Pollutants"    "Metals"            "PBDEs"            
 [4] "Organochlorines"   "Bisphenol A"       "Water Pollutants" 
 [7] "Built Environment" "Cotinine"          "Home Environment" 
[10] "Phthalates"        "Noise"             "PFOAs"            
[13] "Temperature"      </code></pre>
<p>The argument <code>by.exposure = TRUE</code> lists the family names and the exposures that contain each family.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.familyNames.html">ds.familyNames</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
            AbsPM25                  As              BDE100              BDE138 
   "Air Pollutants"            "Metals"             "PBDEs"             "PBDEs" 
             BDE153              BDE154               BDE17              BDE183 
            "PBDEs"             "PBDEs"             "PBDEs"             "PBDEs" 
             BDE190              BDE209               BDE28               BDE47 
            "PBDEs"             "PBDEs"             "PBDEs"             "PBDEs" 
              BDE66               BDE71               BDE85               BDE99 
            "PBDEs"             "PBDEs"             "PBDEs"             "PBDEs" 
            Benzene                bHCH                 BPA                BTHM 
   "Air Pollutants"   "Organochlorines"       "Bisphenol A"  "Water Pollutants" 
                 Cd               CHCl3                  Co                Conn 
           "Metals"  "Water Pollutants"            "Metals" "Built Environment" 
           Cotinine                  Cs                  Cu                 DDE 
         "Cotinine"            "Metals"            "Metals"   "Organochlorines" 
                DDT                Dens                 ETS        G_pesticides 
  "Organochlorines" "Built Environment"  "Home Environment"  "Home Environment" 
                Gas               Green        H_pesticides                 HCB 
 "Home Environment" "Built Environment"  "Home Environment"   "Organochlorines" 
                 Hg                MBzP               MEHHP                MEHP 
           "Metals"        "Phthalates"        "Phthalates"        "Phthalates" 
              MEOHP                 MEP                MiBP                MnBP 
       "Phthalates"        "Phthalates"        "Phthalates"        "Phthalates" 
                 Mo                  Ni                  NO                 NO2 
           "Metals"            "Metals"    "Air Pollutants"    "Air Pollutants" 
            Noise_d             Noise_n                 NOx                  Pb 
            "Noise"             "Noise"    "Air Pollutants"            "Metals" 
             PCB118              PCB138              PCB153              PCB180 
  "Organochlorines"   "Organochlorines"   "Organochlorines"   "Organochlorines" 
              PFHxS                PFNA                PFOA                PFOS 
            "PFOAs"             "PFOAs"             "PFOAs"             "PFOAs" 
               PM10              PM10Cu              PM10Fe               PM10K 
   "Air Pollutants"    "Air Pollutants"    "Air Pollutants"    "Air Pollutants" 
             PM10Ni               PM10S              PM10SI               PM10V 
   "Air Pollutants"    "Air Pollutants"    "Air Pollutants"    "Air Pollutants" 
             PM10Zn                PM25              PM25CU              PM25FE 
   "Air Pollutants"    "Air Pollutants"    "Air Pollutants"    "Air Pollutants" 
              PM25K              PM25Ni               PM25S              PM25Sl 
   "Air Pollutants"    "Air Pollutants"    "Air Pollutants"    "Air Pollutants" 
              PM25V              PM25Zn            PMcoarse                  Sb 
   "Air Pollutants"    "Air Pollutants"    "Air Pollutants"            "Metals" 
                 Se                Temp                 THM                  Tl 
           "Metals"       "Temperature"  "Water Pollutants"            "Metals" 
           X2cxMMHP            X5cxMEPP           X7OHMMeOP                  Zn 
       "Phthalates"        "Phthalates"        "Phthalates"            "Metals" </code></pre>
</div>
<div class="section level4">
<h4 id="exposures-and-phenotypes-names">Exposures and phenotypes names<a class="anchor" aria-label="anchor" href="#exposures-and-phenotypes-names"></a>
</h4>
<p>To get the names of the exposures or phenotypes (or both combined) there’s the function <code><a href="../reference/ds.exposome_variables.html">ds.exposome_variables()</a></code>. The argument <code>target</code> allows to see the names of the <code>exposures</code>, <code>phenotypes</code> or <code>all</code>..</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_variables.html">ds.exposome_variables</a></span><span class="op">(</span><span class="st">"exposome_object"</span> , target<span class="op">=</span><span class="st">"phenotypes"</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
[1] "whistling_chest" "flu"             "rhinitis"        "wheezing"       
[5] "birthdate"       "sex"             "age"             "cbmi"           
[9] "blood_pre"      </code></pre>
</div>
<div class="section level4">
<h4 id="summary-of-variables">Summary of variables<a class="anchor" aria-label="anchor" href="#summary-of-variables"></a>
</h4>
<p>Non-disclosive descriptive statistics can be obtained from the exposome dataset, the function <code>ds.exposome_summary</code> is in charge of that. It can obtain descriptive statistics from numeric and factor variables of the exposome dataset (both from exposures and phenotypes).</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Numerical variable</span>
<span class="fu"><a href="../reference/ds.exposome_summary.html">ds.exposome_summary</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="st">"PM25"</span>, <span class="va">conns</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
$server1$class
[1] "numeric"

$server1$length
[1] 109

$server1$`quantiles &amp; mean`
      5%      10%      25%      50%      75%      90%      95%     Mean 
1.093217 1.132021 1.146654 1.171904 1.181451 1.202192 1.216758 1.165488 </code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Factor variable</span>
<span class="fu"><a href="../reference/ds.exposome_summary.html">ds.exposome_summary</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="st">"flu"</span>, <span class="va">conns</span><span class="op">)</span></code></pre></div>
<pre><code>$server1
$server1$class
[1] "character"

$server1$length
[1] 109</code></pre>
</div>
<div class="section level4">
<h4 id="missing-data">Missing data<a class="anchor" aria-label="anchor" href="#missing-data"></a>
</h4>
<p>The number of missing data on each exposure and on each phenotype can be found by using the function <code>ds.tableMissings</code>. This function returns a vector with the amount of missing data in each exposure or phenotype. The argument <code>set</code> indicates if the number of missing values is counted on exposures or phenotypes. The argument <code>output</code> indicates if it is shown as counts (<code>output="n"</code>) or as percentage (<code>output="p"</code>).</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">expos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.tableMissings.html">ds.tableMissings</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, set <span class="op">=</span> <span class="st">"exposures"</span><span class="op">)</span>
<span class="va">phenos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.tableMissings.html">ds.tableMissings</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, set <span class="op">=</span> <span class="st">"phenotypes"</span><span class="op">)</span></code></pre></div>
<p>Optionally, there’s also the <code>ds.plotMissings</code> function which returns a <code>ggplot</code> object with a barplot of missings for exposures or phenotypes, there’s the option of displaying the percentage of missings as well as total counts, check the function documentation for further information.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.plotMissings.html">ds.plotMissings</a></span><span class="op">(</span><span class="va">expos</span><span class="op">)</span></code></pre></div>
<pre><code>$pooled</code></pre>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.plotMissings.html">ds.plotMissings</a></span><span class="op">(</span><span class="va">phenos</span><span class="op">)</span></code></pre></div>
<pre><code>$pooled</code></pre>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-32-2.png" width="700"></p>
<p>Please note that since this function call returns a <code>ggplot</code> object, it can be plotted properly to avoid squished Y axis when there are lots of exposures, read the <a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">official documentation</a> for information on how to do that.</p>
</div>
<div class="section level4">
<h4 id="exposures-normality">Exposures Normality<a class="anchor" aria-label="anchor" href="#exposures-normality"></a>
</h4>
<p>Most of the test done in <em>exposome</em> analysis requires that the exposures must follow a normal distribution. The function <code>ds.normalityTest</code> performs a test on each exposure for normality behaviour. The result is a <code>data.frame</code> with the exposures’ names, a flag <code>TRUE</code>/<code>FALSE</code> for normality and the p-value obtained from the <em>Shapiro-Wilk</em> Normality Test (if the p-value is under the threshold, then the exposure is not normal).</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.normalityTest.html">ds.normalityTest</a></span><span class="op">(</span><span class="st">"exposome_object"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">nm</span><span class="op">$</span><span class="va">server1</span><span class="op">$</span><span class="va">normality</span><span class="op">)</span></code></pre></div>
<pre><code>
FALSE  TRUE 
   55    29 </code></pre>
<p>So, the exposures that do not follow a normal distribution are:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nm</span><span class="op">$</span><span class="va">server1</span><span class="op">$</span><span class="va">exposure</span><span class="op">[</span><span class="op">!</span><span class="va">nm</span><span class="op">$</span><span class="va">server1</span><span class="op">$</span><span class="va">normality</span><span class="op">]</span></code></pre></div>
<pre><code> [1] "DDT"      "PM10SI"   "PM25K"    "PM25Sl"   "PCB118"   "Tl"      
 [7] "PM10V"    "PM25Zn"   "PM25FE"   "PM10K"    "BDE17"    "PM25"    
[13] "PMcoarse" "PM10"     "BPA"      "Green"    "NO2"      "Cs"      
[19] "PFNA"     "PCB153"   "PM25CU"   "MEOHP"    "Cu"       "HCB"     
[25] "MEHHP"    "DDE"      "BDE190"   "bHCH"     "PM10Zn"   "MnBP"    
[31] "NO"       "NOx"      "PM10S"    "MEHP"     "PCB138"   "Zn"      
[37] "X2cxMMHP" "PCB180"   "PFOA"     "PFHxS"    "Cotinine" "PM25S"   
[43] "Co"       "Conn"     "PM25Ni"   "PM10Ni"   "Cd"       "Dens"    
[49] "Se"       "X5cxMEPP" "BDE183"   "BDE28"    "Sb"       "BDE138"  
[55] "PM25V"   </code></pre>
<p>The <code>ds.normalityTest</code> function has some extra input arguments to tune the normality test, check the function documentation for further information.</p>
<p>The exposures can be visualized using non-disclosive histograms to see their distribution along their <em>Shapiro-Wilk</em> Normality Test p-value.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposure_histogram.html">ds.exposure_histogram</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="st">"AbsPM25"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<p>If the selected exposure is not following a normal distribution, the function <code>ds.exposure_histogram</code> accepts the argument <code>show.trans</code> to visualize the raw data histogram plus three typical transformations (<code>exp</code>, <code>log</code> and <code>sqrt</code>), the <em>Shapiro-Wilk</em> Normality Test p-value is shown for all the transformations.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposure_histogram.html">ds.exposure_histogram</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="st">"AbsPM25"</span>, <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="exposures-behaviour">Exposures Behaviour<a class="anchor" aria-label="anchor" href="#exposures-behaviour"></a>
</h4>
<p>We can get a snapshot of the behaviour of the full exposome using the <code>ds.plotFamily</code> function. This function draws a panel of boxplots with all the numeric families of exposures</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.plotFamily.html">ds.plotFamily</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, family <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
<p>We can also plot single families and perform grouping inside of them. This function makes use of the <code>ggplot2</code> library to generate the plots. Future plans include displaying non-disclosive plots for non-numeric families.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.plotFamily.html">ds.plotFamily</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, family <span class="op">=</span> <span class="st">"Phthalates"</span>, group <span class="op">=</span> <span class="st">"sex"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="exposures-imputation">Exposures Imputation<a class="anchor" aria-label="anchor" href="#exposures-imputation"></a>
</h3>
<p>The missings of an exposome dataset can be imputed using the <code>ds.imputation</code> function, which calls the rexposome function <code>imputation</code> on the study server. Refer to the documentation of rexposome for details about the imputation procedures.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.imputation.html">ds.imputation</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="st">"exposome_object_imputed"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exwas">ExWAS<a class="anchor" aria-label="anchor" href="#exwas"></a>
</h3>
<p>When the <code>ExposomeSet</code> object is on the study the server, the function <code>ds.exwas</code> is in charge of performing the ExWAS. As an example let’s present a situation where we are interested in associating each exposure with <code>blood_pre</code> phenotype (e.g outcome) using the <code>sex</code> as a covariate (e.g. adjusted model). This study would be done as follows</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exwas_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.exwas.html">ds.exwas</a></span><span class="op">(</span><span class="st">"blood_pre ~ sex"</span>, Set <span class="op">=</span> <span class="st">"exposome_object"</span>, family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "The computation of threshold for effective tests was not successful. NAs were generated on the correlation matrix so the calculation was aborted."</code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">exwas_results</span><span class="op">$</span><span class="va">exwas_results</span><span class="op">)</span></code></pre></div>
<pre><code>  exposure         family coefficient      minE      maxE      p.value
1  AbsPM25 Air Pollutants  20.2567443 11.532500 28.980989 5.343657e-06
2       As         Metals   0.5049329 -1.637091  2.646956 6.440695e-01
3   BDE100          PBDEs  -1.4684745 -5.073223  2.136273 4.246181e-01
4   BDE138          PBDEs   1.2819339 -4.872401  7.436269 6.830857e-01
5   BDE153          PBDEs   2.8699183 -1.252769  6.992606 1.724462e-01
6   BDE154          PBDEs   0.1317781 -5.381815  5.645371 9.626373e-01</code></pre>
<p>This previous formula will fit linear models between the exposures and phenotype as follows:</p>
<pre><code><span class="va">phenotype</span> <span class="op">~</span> <span class="va">exposure_1</span> <span class="op">+</span> <span class="va">covar1</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="va">covarN</span>
    <span class="va">phenotype</span> <span class="op">~</span> <span class="va">exposure_2</span> <span class="op">+</span> <span class="va">covar1</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="va">covarN</span>
    <span class="va">phenotype</span> <span class="op">~</span> <span class="va">exposure_3</span> <span class="op">+</span> <span class="va">covar1</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="va">covarN</span>
    <span class="va">...</span>
    <span class="va">phenotype</span> <span class="op">~</span> <span class="va">exposure_M</span> <span class="op">+</span> <span class="va">covar1</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="va">covarN</span></code></pre>
<p>The model is written as a string, where the left side term is the phenotype, and the right term are the covariates (e.g. variables to be adjusted for). In the case of having more covariates proceed as: <code>phenotype ~ cov1 + cov2 + ... + covN</code>. A crude model is fitted using <code>phenotype ~ 1</code>.</p>
<p>It’s important to note that if the family argument does not match with the nature of the data availalbe in the <code>phenotype</code>, the ExWAS will fail (Example: family argument should be <code>binomial</code> for binary outcomes and <code>gaussian</code> for continuous).</p>
<p>To visualize the results from the ExWAS, the function <code><a href="../reference/ds.plotExwas.html">ds.plotExwas()</a></code> can be used. It takes the output of <code>ds.exwas</code> and creates two different visualizations depending on the argument <code>type</code>.</p>
<ul>
<li>A Manhattan-like plot with the p-values of the association between each exposure and the outcome colored by families of exposures. The vertical red line stands for the significant level corrected by the effective number of tests.</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.plotExwas.html">ds.plotExwas</a></span><span class="op">(</span><span class="va">exwas_results</span>, type<span class="op">=</span><span class="st">"manhattan"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-41-1.png" width="960"></p>
<ul>
<li>A plot showing the effects (beta values) and their confidence intervals of a given model can be obtained with:</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.plotExwas.html">ds.plotExwas</a></span><span class="op">(</span><span class="va">exwas_results</span>, type<span class="op">=</span><span class="st">"effect"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-42-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="inverse-exwas">Inverse ExWAS<a class="anchor" aria-label="anchor" href="#inverse-exwas"></a>
</h3>
<p>We can also carry out an ‘inverse’ ExWAS where exposures are regressed on a given phenotype and some adjusting covariates. In other words, we are estimating an inverse/reverse model as in a traditional ExWAS:</p>
<pre><code><span class="va">exposure_1</span> <span class="op">~</span> <span class="va">phenotype</span> <span class="op">+</span> <span class="va">covar1</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="va">covarN</span>
    <span class="va">exposure_2</span> <span class="op">~</span> <span class="va">phenotype</span> <span class="op">+</span> <span class="va">covar1</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="va">covarN</span>
    <span class="va">exposure_3</span> <span class="op">~</span> <span class="va">phenotype</span> <span class="op">+</span> <span class="va">covar1</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="va">covarN</span>
    <span class="va">...</span>
    <span class="va">exposure_M</span> <span class="op">~</span> <span class="va">phenotype</span> <span class="op">+</span> <span class="va">covar1</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="va">covarN</span></code></pre>
<p>The function to perform this analysis is <code><a href="../reference/ds.invExWAS.html">ds.invExWAS()</a></code>. In that case the formula is not used and the models can be fitted by</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inverse_exwas_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.invExWAS.html">ds.invExWAS</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, phenotype <span class="op">=</span>  <span class="st">"blood_pre"</span>, covariables <span class="op">=</span> <span class="st">"sex"</span><span class="op">)</span></code></pre></div>
<pre><code>Called from: ds.invExWAS("exposome_object", phenotype = "blood_pre", covariables = "sex")
debug: cally &lt;- paste0("invExWASDS(", object, ", '", phenotype, "', ", 
    tef, if (is.null(covariables)) {
        ")"
    } else {
        paste0(", '", paste(covariables, collapse = "','"), "')")
    })
debug: paste0(", '", paste(covariables, collapse = "','"), "')")
debug: res &lt;- DSI::datashield.aggregate(datasources, as.symbol(cally))[[1]]
debug: inv_exwas_results &lt;- res@comparison
debug: inv_exwas_results &lt;- tibble::rownames_to_column(as.data.frame(inv_exwas_results), 
    "exposure")
debug: assoc &lt;- ds.familyNames(object, TRUE)[[1]]
debug: assoc &lt;- data.frame(family = assoc, exposure = names(assoc))
debug: inv_exwas_results &lt;- merge(assoc, inv_exwas_results)
debug: colnames(inv_exwas_results) &lt;- c("exposure", "family", "coefficient", 
    "minE", "maxE", "p.value")
debug: alpha_corrected &lt;- res@effective
debug: results &lt;- list(exwas_results = inv_exwas_results, alpha_corrected = alpha_corrected)
debug: class(results) &lt;- c(class(results), "dsExWAS_pooled")
debug: return(results)</code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">inverse_exwas_results</span><span class="op">$</span><span class="va">exwas_results</span><span class="op">)</span></code></pre></div>
<pre><code>  exposure         family   coefficient         minE       maxE      p.value
1  AbsPM25 Air Pollutants  0.0081980195  0.004667268 0.01172877 7.857332e-05
2       As         Metals  0.0051420757 -0.016671610 0.02695576 3.409380e-02
3   BDE100          PBDEs -0.0141696614 -0.048952736 0.02061341 1.255577e-01
4   BDE138          PBDEs  0.0043099492 -0.016381344 0.02500124 4.058545e-01
5   BDE153          PBDEs  0.0203581338 -0.008886681 0.04960295 1.702485e-01
6   BDE154          PBDEs  0.0005550306 -0.022667443 0.02377750 8.734483e-01</code></pre>
<p>Crude models are obtained by removing the <code>covariables</code> argument and models adjusted for more than one covariable are fitted by writing <code>covariables = c("covar1", "covar2", ..., "covarN")</code>.</p>
<p>The same plotting functions can be used with the object returned by the inverse ExWAS analysis.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.plotExwas.html">ds.plotExwas</a></span><span class="op">(</span><span class="va">inverse_exwas_results</span>, <span class="st">"manhattan"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-44-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="exposures-pca">Exposures PCA<a class="anchor" aria-label="anchor" href="#exposures-pca"></a>
</h3>
<p>A PCA can be performed on the exposures of the exposome dataset. To do so, there’s the <code>ds.exposome_pca</code>. The exposures should be standardized in order to perform the PCA properly, to do so, there’s the arguments <code>standar</code> and <code>method</code>, which standardize the Exposome Set before performing the PCA following the specified <code>method</code>. The available methods are <code>normal</code> (default method), which scales the exposures using the mean as the center and the standard variation as dispersion; the <code>robust</code> method, which uses the median and median absolute deviation respectively; and, <code>interquartile range</code>, which uses the median as the center and the coeficient between the interquartile range of the exposure and the normal range between the percentile 75 and 25 as variance. It is important noting that this function is sensitive to be disclosive, specially for very rectangular data frames (similar number of variables as individuals). To illustrate this problem, let’s try to perform a PCA on the whole exposures test data.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca.html">ds.exposome_pca</a></span><span class="op">(</span><span class="st">"exposome_object"</span><span class="op">)</span></code></pre></div>
<pre><code>Error: There are some DataSHIELD errors, list them with datashield.errors()</code></pre>
<p>If that is the case, one option is to reduce the families of exposures of the Exposome Set. The <code>ds.exposome_pca</code> function has the argument <code>fam</code> to select the families to subset the Exposome Set to perform the PCA.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca.html">ds.exposome_pca</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, fam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Metals"</span>, <span class="st">"Noise"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The PCA function saves the results on the study server to prevent any dislosures, the default variable they take is called <code>"ds.exposome_pca.Results"</code>, which has to be passed to the visualization function. To visualize the results of the PCA there is the function <code>ds.exposome_pca_plot</code>, this function relies on the visualization methods already implemented on <code>rexposome</code> for the PCA analysis, it does it however on a non-disclosive way, by passing the scatter plot points through an anonimization process, hence the arguments <code>k</code>, <code>method</code> and <code>noise</code>. The visualization is controlled with the <code>set</code> argument, which takes <code>"all"</code> (mosaic of plots of the PCA), <code>"exposures"</code> (plot of the exposures space on the first two principal components, color coded by family), <code>"samples"</code> (plot of the individuals space on the first two principal components, this plot can take the <code>phenotype</code> argument to color code the individuals by phenotypes), <code>"variance"</code> and <code>"variance_explained"</code>, the two variance plots are quite self explanatory, the color code on the <code>"variance"</code> highlights the first two principal components as they are the ones shown on the other drawings.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca_plot.html">ds.exposome_pca_plot</a></span><span class="op">(</span><span class="st">"ds.exposome_pca.Results"</span>, set <span class="op">=</span> <span class="st">"all"</span>, method <span class="op">=</span> <span class="fl">1</span>, k <span class="op">=</span> <span class="fl">3</span>, noise <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-47-1.png" width="700"></p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca_plot.html">ds.exposome_pca_plot</a></span><span class="op">(</span><span class="st">"ds.exposome_pca.Results"</span>, set <span class="op">=</span> <span class="st">"samples"</span>, phenotype <span class="op">=</span> <span class="st">"sex"</span>, method <span class="op">=</span> <span class="fl">1</span>, k <span class="op">=</span> <span class="fl">3</span>, noise <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-47-2.png" width="700"></p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca_plot.html">ds.exposome_pca_plot</a></span><span class="op">(</span><span class="st">"ds.exposome_pca.Results"</span>, set <span class="op">=</span> <span class="st">"exposures"</span>, method <span class="op">=</span> <span class="fl">1</span>, k <span class="op">=</span> <span class="fl">3</span>, noise <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-47-3.png" width="700"></p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca_plot.html">ds.exposome_pca_plot</a></span><span class="op">(</span><span class="st">"ds.exposome_pca.Results"</span>, set <span class="op">=</span> <span class="st">"variance"</span>, method <span class="op">=</span> <span class="fl">1</span>, k <span class="op">=</span> <span class="fl">3</span>, noise <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-47-4.png" width="700"></p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca_plot.html">ds.exposome_pca_plot</a></span><span class="op">(</span><span class="st">"ds.exposome_pca.Results"</span>, set <span class="op">=</span> <span class="st">"variance_explained"</span>, method <span class="op">=</span> <span class="fl">1</span>, k <span class="op">=</span> <span class="fl">3</span>, noise <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-47-5.png" width="700"></p>
<p>Furthermore, the <code>ds.exposome_pca_plot</code> function can plot the correlations betweeen the principal components and the exposures and the association of the phenotypes with the principal components. This two visualizations can be obtained by setting the <code>set</code> argument to <code>"exposures_correlation"</code> and <code>"phenotypes_correlation"</code> respectively.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca_plot.html">ds.exposome_pca_plot</a></span><span class="op">(</span><span class="st">"ds.exposome_pca.Results"</span>, set <span class="op">=</span> <span class="st">"exposures_correlation"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca_plot.html">ds.exposome_pca_plot</a></span><span class="op">(</span><span class="st">"ds.exposome_pca.Results"</span>, set <span class="op">=</span> <span class="st">"phenotypes_correlation"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-48-2.png" width="700"></p>
<p>By default, the <code>ds.exposome_pca</code> function only uses the numeric exposures, as a principal component analysis is by definition an analysis applied to numeric variables. If our exposures data contains non-numeric variable (categorical) we may be interested on including them on the analysis. A principal components method that contemplates mixed data is the factor analysis of mixed data (FAMD). To use this method instead of a traditional PCA, there is an argument on the <code>ds.exposome_pca</code> function called <code>pca</code>, set it to <code>FALSE</code> to perform a FAMD.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca.html">ds.exposome_pca</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, fam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Metals"</span>, <span class="st">"Noise"</span><span class="op">)</span>, pca <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>The same functions used to plot the regular PCA can be used to plot the results of the FAMD.</p>
</div>
<div class="section level3">
<h3 id="exposures-hcpc">Exposures HCPC<a class="anchor" aria-label="anchor" href="#exposures-hcpc"></a>
</h3>
<p>A HCPC (hierarchical classification on principle components) can be performed on the exposures of the exposome dataset. To do so, there’s the <code>ds.exposome_HCPC</code>. By default, the number of clusters discovered is the one with the higher relative loss of inertia <code>(i(clusters n+1)/i(cluster n))</code>, the user can also specify the number of clusters with the argument <code>nb.clust</code>. This function has to be passed the server object that holds the results of a PCA.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_pca.html">ds.exposome_pca</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, fam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Metals"</span>, <span class="st">"Noise"</span><span class="op">)</span><span class="op">)</span>
<span class="va">hcpc</span><span class="op">=</span><span class="fu"><a href="../reference/ds.exposome_HCPC.html">ds.exposome_HCPC</a></span><span class="op">(</span><span class="st">"ds.exposome_pca.Results"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>The object returned by the servers can be plotted using the <code><a href="https://rdrr.io/pkg/FactoMineR/man/plot.HCPC.html" class="external-link">FactoMineR::plot.HCPC</a></code> function.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">FactoMineR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/plot.HCPC.html" class="external-link">plot.HCPC</a></span><span class="op">(</span><span class="va">hcpc</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-51-1.png" width="700"></p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">FactoMineR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/plot.HCPC.html" class="external-link">plot.HCPC</a></span><span class="op">(</span><span class="va">hcpc</span>, choice <span class="op">=</span> <span class="st">"tree"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-51-2.png" width="700"></p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">FactoMineR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/plot.HCPC.html" class="external-link">plot.HCPC</a></span><span class="op">(</span><span class="va">hcpc</span>, choice <span class="op">=</span> <span class="st">"bar"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-51-3.png" width="700"></p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">FactoMineR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/plot.HCPC.html" class="external-link">plot.HCPC</a></span><span class="op">(</span><span class="va">hcpc</span>, choice <span class="op">=</span> <span class="st">"map"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-51-4.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="exposures-correlation">Exposures Correlation<a class="anchor" aria-label="anchor" href="#exposures-correlation"></a>
</h3>
<p>The correlation between exposures, in terms of intra-family and inter-family exposures, is interesting to take into account. The correlation of the exposome can be computed using <code>ds.correlation</code>. The correlation could be disclosive, for that reason there’s the argument <code>fam</code> to select the families to compute the correlation subsetting the exposome dataset by families, typical complete exposome datasets will fail as the correlation matrix could be disclosive.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_correlation.html">ds.exposome_correlation</a></span><span class="op">(</span><span class="st">"exposome_object"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`Correlation Matrix`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code>Error: There are some DataSHIELD errors, list them with datashield.errors()</code></pre>
<p>When subsetting the exposome set by families the correlation succeeds.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ds.exposome_correlation.html">ds.exposome_correlation</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Metals"</span>, <span class="st">"Noise"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`Correlation Matrix`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code>            [,1]       [,2]        [,3]       [,4]        [,5]
[1,]  1.00000000 0.08897651 -0.12603679  0.1112793 -0.03127031
[2,]  0.08897651 1.00000000  0.10209881  0.5356812  0.84660044
[3,] -0.12603679 0.10209881  1.00000000 -0.5111215 -0.05851681
[4,]  0.11127929 0.53568121 -0.51112146  1.0000000  0.47229280
[5,] -0.03127031 0.84660044 -0.05851681  0.4722928  1.00000000</code></pre>
<p>The output from the <code>ds.correlation</code> consists of the correlation matrix and a vector that contains the names of exposures and families on the correlation table, this second item is used by the <code>corPlot</code> function to display the results of the correlation study.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corr_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.exposome_correlation.html">ds.exposome_correlation</a></span><span class="op">(</span><span class="st">"exposome_object"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Metals"</span>, <span class="st">"Noise"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/corPlot.html">corPlot</a></span><span class="op">(</span><span class="va">corr_data</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-54-1.png" width="700"></p>
<p>The best option to see the inter-family correlations is the <em>circos of correlations</em> while the <em>matrix of correlations</em> is a better way for studying the intra-family correlations.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/corPlot.html">corPlot</a></span><span class="op">(</span><span class="va">corr_data</span>, type <span class="op">=</span> <span class="st">"circos"</span><span class="op">)</span></code></pre></div>
<p><img src="dsExposome_files/figure-html/unnamed-chunk-55-1.png" width="700"></p>
<p>To end, we close the connection</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.logout.html" class="external-link">datashield.logout</a></span><span class="op">(</span><span class="va">conns</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Xavier Escriba-Montagut.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
